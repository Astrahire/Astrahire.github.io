<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstraHire - Job Listings</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Welcome to AstraHire</h1>
    </header>
    
    <section id="vision">
        <h2>Our Vision</h2>
        <p>To be the leading recruitment platform that revolutionizes hiring by seamlessly connecting talent with the best opportunities through technology and innovation.</p>
    </section>

    <section id="current-openings">
        <h2>Current Openings
            <button id="refresh-jobs">ðŸ”„ Refresh</button>
        </h2>
        <p>Stay updated with the latest job opportunities!</p>
        <div id="job-listings">Loading job listings...</div>
    </section>

    <section id="apply">
        <h2>Apply for a Job</h2>
        <form id="job-application">
            <label for="name">Full Name:</label>
            <input type="text" id="name" required>

            <label for="email">Email:</label>
            <input type="email" id="email" required>

            <label for="linkedin">LinkedIn Profile:</label>
            <input type="url" id="linkedin">

            <label for="experience">Years of Experience:</label>
            <input type="number" id="experience" min="0" required>

            <label for="suitability">Why do you think you are suitable for this role?</label>
            <textarea id="suitability" required></textarea>

            <button type="submit">Submit Application</button>
        </form>
    </section>

    <footer>
        <p>&copy; 2025 AstraHire. All Rights Reserved.</p>
    </footer>

    <script>
        document.getElementById("refresh-jobs").addEventListener("click", fetchJobs);

        async function fetchJobs() {
            const sheetID = "16qgWiQ1r5aW37r8ru8vBmCGjGbf0ADMECReR1QMXjKc";
            const sheetName = "Sheet1";  // Ensure the correct sheet name is used
            const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

            const jobList = document.getElementById("job-listings");
            jobList.innerHTML = "Loading...";

            try {
                const response = await fetch(url);
                const text = await response.text();
                const jsonData = JSON.parse(text.substring(47, text.length - 2));  // Clean response
                const rows = jsonData.table.rows;

                let jobHTML = "<ul>";
                rows.slice(1).forEach(row => { // Skip header row
                    const [jobID, role, info, description, salary] = row.c.map(cell => cell?.v || "N/A");
                    jobHTML += `
                        <li>
                            <strong>${role}</strong> - ${info} <br>
                            ${description} <br>
                            <strong>Salary:</strong> ${salary}
                        </li>`;
                });
                jobHTML += "</ul>";

                jobList.innerHTML = jobHTML;
            } catch (error) {
                console.error("Error fetching jobs:", error);
                jobList.innerHTML = "Failed to load job listings. Please try again.";
            }
        }

        // Initial Fetch
        fetchJobs();
    </script>
</body>
</html>
